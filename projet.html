<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    
    <!-- CSS -->
    <link rel="stylesheet" href="style.css">

    <title>PROJET PKI</title>

    <!-- CDN Google -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">

    <!-- CDN Bootsrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    
    <!-- CDN Axios -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>

<!-- For prod : vue.esm-browser.prod.js -->
<script type="importmap">
    {
        "imports": {
            "vue": "https://unpkg.com/vue@3/dist/vue.esm-browser.js"
        }
    }
</script>

<body class="container-fluid" v-show="!loading">
    <div id="app">
        <!-- Loading animation -->
        <div v-if="loading" id="loading-animation">
            <div class="spinner"></div>
        </div> <!-- Loading animation -->

        <h1>PROJET PKI</h1>
    </div>

    <div class="projet">
        <div class="client-vendeur">
            <!-- CLIENT -->
            <div class="client" id="client">
                <div v-if="clientAvailable" class="client-content">
                    <div class="client-header">
                        <span class="material-icons s_XL">person</span>
                        <h5>Client actif</h5>
                    </div>

                    <div class="client-operations operations">
                        <h5 class="c_1 text-center">Opérations disponibles</h5>
                        <hr>

                        <div class="operations-btns mt-1">
                            <!-- Obtenir la clé publique -->
                            <div class="operation-btn mb-2 bg_1">
                                <label for="operation" class="form-label">Obtenir une clé publique</label>
                                <select class="form-select" aria-label="Default select example" v-model="selectedPubKeyReq">
                                    <option selected disabled>Choisir</option>
                                    <option value="vendeur">Vendeur</option>
                                    <option value="ca">Ca</option>
                                </select>
                                <button class="btn btn-sm btn-success mt-2" type="button" :disabled="selectedPubKeyReq === null" @click="getPubKey">Obtenir</button>
                            </div> <!-- Obtenir la clé publique -->

                            <div class="div-flex">
                                <div class="operation-btn gap-2 mb-2 bg_2">
                                    <label for="operation" class="form-label">Génération de clés AES</label>
                                    <button @click="generateAesKey('seller')" class="btn btn-sm btn-primary">A Utiliser avec le vendeur</button>
                                    <button @click="generateAesKey('ca')" class="btn btn-sm btn-success">A Utiliser avec la CA</button>
                                </div>
    
                                <div class="operation-btn mb-2 bg_1">
                                    <label for="operation" class="form-label">Échanges de secrets</label>
                                    <button @click="secretExchangeCa" class="btn btn-sm btn-primary">Avec la CA</button>
                                    <button @click="secretExchangeSeller" class="btn btn-sm btn-success">Avec le Vendeur</button>
                                </div>
                            </div>

                            <div class="operation-btn mb-2 bg_1">
                                <label for="operation" class="form-label">Générer une paire de clés RSA 2048</label>
                                <button @click="generateRsaKey" class="btn btn-sm btn-primary">Générer ma paire de clés</button>
                            </div>

                            <div class="verifs-cles-aes-rsa bg_2">
                                <label for="operation" class="form-label">Vérifier la disponibilité des clés sur le serveur</label>
                                <div class="div-flex">
                                    <div class="operation-btn mb-2 bg_2">
                                        <div class="btns-flex">
                                            <button @click="checkAesKey('ca')" class="btn btn-sm btn-primary" type="button">AES/CA</button>
                                            <button @click="checkAesKey('seller')" class="btn btn-sm btn-success" type="button">AES/VENDEUR</button>
                                            <button @click="checkRsaKey" class="btn btn-sm btn-warning" type="button">RSA/CLIENT</button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Liste des clé AES -->
                            <div class="operation-btn mb-2 bg_1">
                                <a @click="getAllAesKeys" class="material-icons c_1 cleaner_icon">refresh</a>
                                <br>
                                <label for="operation" class="form-label">Liste des clés AES à disposition</label>
                                <select :disabled="aesKeys.length === 0" class="form-select" aria-label="Aes list keys">
                                    <option v-for="aesKey in aesKeys" :key="aesKey.identifiant" :value="aesKey.key">
                                        {{ aesKey.identifiant }} : {{ aesKey.key }}
                                    </option>
                                </select>
                            </div> <!-- Liste des clé AES -->

                            <!-- Liste des clé AES -->
                            <div class="operation-btn mb-2 bg_2">
                                <label for="getSellerCertificate" class="form-label">Effectuer un achat</label>
                                <button @click="getSellerCertificate" class="btn btn-sm btn-success">Obtenir et vérifier le certificat</button>
                                
                            </div> <!-- Liste des clé AES -->
                        </div>
                    </div>

                    <div class="client-print print">
                        <h6 class="c_1">Sortie</h6> 
                        <a @click="cleanPrintClient" class="material-icons c_2 cleaner_icon">cleaning_services</a>
                        <div class="print-final">
                            {{ printClient }}
                        </div>
                    </div>
                </div>
                <div v-else class="client-off">
                    <span class="material-icons s_XL">error</span>
                    <h6>Veuillez allumer le serveur du client.</h2>
                </div>
            </div> <!-- CLIENT -->
            
            <!-- VENDEUR -->
            <div class="vendeur" id="vendeur">
                <div v-if="vendeurAvailable" class="vendeur-content">
                    <div class="vendeur-header">
                        <span class="material-icons s_XL">storefront</span>
                        <h5>Vendeur actif</h5>
                    </div>

                    <!-- operations -->
                    <div class="vendeur-operations operations">
                        <h5 class="c_1 text-center">Opérations disponibles</h5>
                        <hr>

                        <div class="operations-btns mt-1">
                            <!-- Obtenir la clé publique -->
                            <div class="operation-btn mb-2 bg_2">
                                <label for="operation" class="form-label">Obtenir une clé publique</label>
                                <select class="form-select" aria-label="Default select example" v-model="selectedPubKeyReq">
                                    <option selected disabled>Choisir</option>
                                    <option value="ca">Ca</option>
                                    <option value="client">Client (Facultatif)</option>
                                </select>
                                <button class="btn btn-sm btn-success mt-2" type="button" :disabled="selectedPubKeyReq === null" @click="getPubKey">Obtenir</button>
                            </div> <!-- Obtenir la clé publique -->

                            <!-- Générations CLES, Echange Secret, Demande Certificat -->
                            <div class="div-flex">
                                <!-- Générations de clé AES -->
                                <div class="operation-btn mb-2 bg_2">
                                    <label for="operation" class="form-label">Générer une clé AES</label>
                                    <button @click="generateAesKey('ca')" class="btn btn-sm btn-success">A Utiliser avec la CA</button>
                                </div> <!-- Générations de clé AES -->
                                
                                <!-- Echange du secret -->
                                <div class="operation-btn mb-2 bg_1">
                                    <label for="operation" class="form-label">Échanges du secret</label>
                                    <button @click="secretExchangeCa" class="btn btn-sm btn-primary">Avec la CA</button>
                                </div> <!-- Echange du secret -->

                                <!-- Demande de certificat -->
                                <div class="operation-btn mb-2 bg_1">
                                    <label for="operation" class="form-label">Demander un certificat à la CA</label>
                                    <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#sellerGenerateCertificat">Demander</button>
                                    
                                    <!-- Modal -->
                                    <div class="modal fade" id="sellerGenerateCertificat" tabindex="-1" aria-labelledby="sellerGenerateCertificat" aria-hidden="true">
                                        <div class="modal-dialog">
                                            <div class="modal-content">
                                                <div class="modal-header">
                                                <h1 class="modal-title fs-5">Demander un certificat</h1>
                                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                </div>
                                                <div class="modal-body">
                                                    <!-- HTML -->
                                                    <form>
                                                        <div class="mb-3">
                                                            <label for="labelInputEmail" class="form-label">Country name</label>
                                                            <input type="email" class="form-control" v-model="country_name">
                                                        </div>
    
                                                        <div class="mb-3">
                                                            <label for="labelInputName" class="form-label">State or province name</label>
                                                            <input type="text" class="form-control" v-model="state_or_province_name">
                                                        </div>
    
                                                        <div class="mb-3">
                                                            <label for="labelInputPrenom" class="form-label">Locality name</label>
                                                            <input type="text" class="form-control" v-model="locality_name">
                                                        </div>
    
                                                        <div class="mb-3">
                                                            <label for="labelInputPrenom" class="form-label">Organization name</label>
                                                            <input type="text" class="form-control" v-model="organization_name">
                                                        </div>
    
                                                        <div class="mb-3">
                                                            <label for="labelInputPrenom" class="form-label">Common name</label>
                                                            <input type="text" class="form-control" v-model="common_name">
                                                        </div>
                                                    </form>
                                                </div>
                                                <div class="modal-footer">
                                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
                                                    <button type="button" @click="handleGenerateCertificat" :disabled="!btnHandleGenerateCertificat" class="btn btn-primary">Confirmer la demande</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div> <!-- Demande de certificat -->

                            </div> <!-- Générations CLES, Echange Secret, Demande Certificat -->

                            <!-- Vérifie la disponibilité des clés -->
                            <div class="verifs-cles-aes-rsa bg_1">
                                <label for="operation" class="form-label">Vérifier la disponibilité des clés</label>
                                <div class="div-flex">
                                    <div class="operation-btn mb-2 bg_2">
                                        <div class="btns-flex">
                                            <button @click="checkAesKey('ca')" class="btn btn-sm btn-primary" type="button">AES/CA</button>
                                            <button @click="checkAesKey('client')" class="btn btn-sm btn-success" type="button">AES/CLIENT</button>
                                            <button @click="checkRsaKey" class="btn btn-sm btn-primary" type="button">RSA/VENDEUR</button>
                                        </div>
                                    </div>
                                </div>
                            </div> <!-- Vérifie la disponibilité des clés -->

                            <!-- Générations des clés RSA -->
                            <div class="operation-btn mb-2 bg_2">
                                <label for="operation" class="form-label">Générer une paire de clés RSA 2048</label>
                                <button @click="generateRsaKey" class="btn btn-sm btn-primary">Générer</button>
                            </div> <!-- Générations des clés RSA -->

                            <!-- Liste des clé AES -->
                            <div class="operation-btn mb-2 bg_1">
                                <a @click="getAllAesKeys" class="material-icons c_1 cleaner_icon">refresh</a>
                                <br>
                                <label for="operation" class="form-label">Liste des clés AES à disposition</label>
                                <select :disabled="aesKeys.length === 0" class="form-select" aria-label="Aes list keys">
                                    <option v-for="aesKey in aesKeys" :key="aesKey.identifiant" :value="aesKey.key">
                                        {{ aesKey.identifiant }} : {{ aesKey.key }}
                                    </option>
                                </select>
                            </div> <!-- Liste des clé AES -->

                            <!-- Certificats à disposition -->
                            <div class="operation-btn mb-2 bg_2">
                                <h5>Scénarios</h5>
                                <a @click="getAllCertificates" class="material-icons c_1 cleaner_icon">refresh</a>
                                <br>
                                <label for="operation" class="form-label">Choisir le certificat à envoyer au client</label>
                                <select :disabled="certificatesList.length === 0" v-model="selectedCertificatToSend" class="form-select" aria-label="List of certificates">
                                    <!-- Option par défaut -->
                                    <option disabled value="">Sélectionnez un certificat</option>
                                    <option v-for="certificate in certificatesList" :key="certificate.identifiant" :value="certificate.identifiant">
                                        {{ certificate.identifiant }} (Révoqué: {{ certificate.revoked }})
                                    </option>
                                </select>
                                <button class="btn btn-sm btn-success mt-2" type="button" :disabled="selectedCertificatToSend === ''" @click="updateCertificatSender">Choisir ce certificat</button>
                                
                                <div class="default-certif mt-2">
                                    <label for="default-certif">Le certificat par défaut</label>
                                    <br>
                                    <span class="badge text-bg-secondary" v-if="default_certif == ''">AUCUN</span>
                                    <b class="badge text-bg-success" v-else>{{ default_certif }}</b>
                                </div>
                            </div> <!-- Certificats à disposition -->
                        </div>
                    </div> <!-- operations -->

                    <div class="vendeur-print print">
                        <h6 class="c_1">Sortie</h6>
                        <a @click="cleanPrintVendeur" class="material-icons c_2 cleaner_icon">cleaning_services</a>
                        <div class="print-final">
                            {{ printVendeur }}
                        </div>
                    </div>

                </div>
                <div v-else class="vendeur-off">
                    <span class="material-icons s_XL">error</span>
                    <h6>Veuillez allumer le serveur du vendeur.</h6>
                </div>
            </div> <!-- VENDEUR -->
        </div> 
        
        <!-- CA -->
        <div class="ca" id="ca">
            <div v-if="caAvailable" class="ca-content">
                <div class="ca-header">
                    <span class="material-icons s_XL">admin_panel_settings</span>
                    <h5>Ca actif</h5>
                </div>

                <div class="ca-operations operations-ca">
                    <h6 class="c_1">Opérations disponibles</h6>

                    <div class="operation-btns-ca">
                        <div class="operation-btn mb-2 bg_1">
                            <label for="operation" class="form-label">Vérifier la présence d'un certificat autosigné</label>
                            <button @click="checkSelfSignedCertificate" class="btn btn-sm btn-primary">Vérifier</button>
                        </div>
                        <div class="operation-btn mb-2 bg_2">
                            <label for="operation" class="form-label">Générer un certificat x509 autosigné</label>
                            <button @click="generateSelfSignedCertificate" class="btn btn-sm btn-primary">Générer</button>
                        </div>
                    </div>
                    
                    <!-- Liste des clé AES -->
                    <a @click="getAllAesKeys" class="material-icons c_1 cleaner_icon">refresh</a>
                    <div class="operation-btn mb-2 bg_2">
                        <label for="operation" class="form-label">Liste des clés AES à disposition</label>
                        <select :disabled="aesKeys.length === 0" class="form-select" aria-label="Aes list keys">
                            <option v-for="aesKey in aesKeys" :key="aesKey.identifiant" :value="aesKey.key">
                                {{ aesKey.identifiant }} : {{ aesKey.key }}
                            </option>
                        </select>
                    </div> <!-- Liste des clé AES -->
                </div>

                <div class="ca-print print">
                    <h6 class="c_1">Sortie</h6>
                    <a @click="cleanPrintCa" class="material-icons c_2 cleaner_icon">cleaning_services</a>
                    <div class="print-final">
                        {{ printCa }}
                    </div>
                </div>
            </div>
            <div v-else class="ca-off">
                <span class="material-icons s_XL">error</span>
                <h6>Veuillez allumer le serveur de la CA.</h6>
            </div>
        </div> <!-- CA -->

    </div>

    <!-- Bootsrap CDN -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

    <!-- VueJS3 -->
    <script type="module">
        import { createApp, onMounted, watch, watchEffect, ref } from 'vue'
        
        // Main app
        createApp({
            setup() {
                // Variables
                let loading = ref(true);

                // Utilisation de l'hook onMounted pour exécuter du code lors du montage de l'application
                onMounted(async () => {
                    // Loading animation
                    window.addEventListener('load', () => {
                        loading.value = false;
                    });
                });

                return {
                    loading,
                }
            }
        }).mount('#app');
        
        // Vendeur
        createApp({
            setup() {
                // Variables
                let error = ref('');
                let vendeurAvailable = ref(false);

                let selectedPubKeyReq = ref(null);
                let selectedCertificatToSend = ref(null);

                // Résultat d'une requête
                let printVendeur = ref('');
                let clearPrintTimer;

                // Génération du certificat
                let country_name = ref('FR');
                let state_or_province_name = ref('MARNE');
                let locality_name = ref('REIMS');
                let organization_name = ref('IM-CORP');
                let common_name = ref('Mahmoud');

                let btnHandleGenerateCertificat = ref(false);
                // Liste des certificats
                let certificatesList = ref([]);
                let default_certif = ref('');

                // Liste des clés AES
                let aesKeys = ref([]);
            
                /*==== FONCTIONS ====*/
                    /*== TOOLS ==*/
                        function cleanPrintVendeur() {
                            printVendeur.value = '';
                        }
                        
                        function autoClearPrintVendeur() {
                            clearTimeout(clearPrintTimer); // Réinitialise le timer à chaque fois que la fonction est appelée
                            clearPrintTimer = setTimeout(cleanPrintVendeur, 10000);
                        }
                        
                        watch(printVendeur, () => {
                            autoClearPrintVendeur();
                        });
                    /*== TOOLS ==*/

                    /*== VERIFY ==*/
                        /**
                        *   Vérifie que le vendeur dispose de clé RSA.
                        */
                        async function checkRsaKey() {
                            try {
                                const result = await a_checkRsaKey();
                                printVendeur.value = result;
                            } catch (error) {
                                console.error('Erreur (checkRsaKey) : ', error);
                            }
                        }

                        /**
                        *   Vérifie que le vendeur dispose d'une clé AES à utiliser 
                        *   avec la CA ou le Client.
                        */
                        async function checkAesKey(name) {
                            try {
                                const result = await a_checkAesKey(name);
                                printVendeur.value = result;
                            } catch (error) {
                                console.error('VENDEUR : Erreur (checkAesKey) :', error);
                            }
                        }
                    /*== END/VERIFY ==*/

                    /*== GET ==*/
                        /*
                        *   Récupère la clé publique de la CA ou du Client.
                        */
                        async function getPubKey() {
                            if (selectedPubKeyReq.value === "ca") {
                                try {
                                    const result = await a_getPubKeyCA();
                                    if(result != -1){
                                        printVendeur.value = result;
                                    } else {
                                        printVendeur.value = "ERREUR SERVEUR.";
                                    }
                                } catch (error) {
                                    printVendeur.value = "ERREUR SERVEUR.";
                                }
                            } 
                            else if (selectedPubKeyReq.value === "client") {
                                try {
                                    const result = await a_getPubKeyClient();
                                    if(result != -1){
                                        printVendeur.value = result;
                                    } else {
                                        printVendeur.value = "ERREUR SERVEUR.";
                                    }
                                } catch (error) {
                                    printVendeur.value = "ERREUR SERVEUR.";
                                }
                            }

                            selectedPubKeyReq.value = null;
                        }

                        /*
                        *   Retourne au format base64 toutes les clés AES
                        *   dont le vendeur dispose.
                        */
                        async function getAllAesKeys() {
                            try {
                                aesKeys.value = [];
                                const result = await a_getAllAesKeys();
                                if (result !== -1) {
                                    aesKeys.value = Object.entries(result).map(([identifiant, key]) => ({ identifiant, key }));
                                }
                            } catch (error) {
                                console.error('Erreur :', error);
                            }
                        }
                        
                        /**
                        *   Retourne la liste de tous les certificats dont   
                        *   le vendeur dispose.
                        */
                        async function getAllCertificates() {
                            try {
                                certificatesList.value = [];
                                const result = await a_getAllCertificates();
                                if (result !== -1) {
                                    certificatesList.value = Object.entries(result).map(([identifiant, data]) => ({
                                        identifiant,
                                        revoked: data.revoked
                                    }));
                                }
                            } catch (error) {
                                console.error('Erreur :', error);
                            }
                        }
                    /*== END/GET ==*/

                    /*== UPDATE ==*/
                        /*
                        *   Génère les clés RSA.
                        */
                        async function updateCertificatSender() {
                            try {
                                const result = await a_updateCertificatSender();
                                printVendeur.value = result;
                            } catch (error) {
                                console.error('VENDEUR: Erreur (updateCertificatSender) :', error);
                            }
                        }
                    /*== END/UPDATE ==*/

                    /*== CREATE ==*/
                        /*
                        *   Génère les clés RSA.
                        */
                        async function generateRsaKey() {
                            try {
                                const result = await a_generateRsaKey();
                                printVendeur.value = result;
                            } catch (error) {
                                console.error('VENDEUR: Erreur (generateRsaKey) :', error);
                            }
                        }

                        /*
                        *   Génère la clé AES.
                        */
                        async function generateAesKey(name) {
                            try {
                                const result = await a_generateAesKey(name);
                                printVendeur.value = result;
                            } catch (error) {
                                printVendeur.value = error;
                                console.error('Erreur :', error);
                            }
                        }

                        /**
                        *   Permet de faire l'échange du secret
                        *   entre le client et la CA.
                        */
                        async function secretExchangeCa() {
                            try {
                                const result = await a_secretExchangeCa();
                                printVendeur.value = result;
                            } catch (error) {
                                console.log("VENDEUR Erreur (secretExchangeCa) : ", error)
                                printVendeur.value = error;
                            }
                        }

                        // Vérifie que tous les champs sont remplis
                        // Pour envoyer le certificat.
                        watchEffect(() => {
                            btnHandleGenerateCertificat.value = common_name.value.trim() !== '' &&
                                                                organization_name.value.trim() !== '' &&
                                                                locality_name.value.trim() !== '' &&
                                                                state_or_province_name.value.trim() !== '' &&
                                                                country_name.value.trim() !== '';
                        });

                        /**
                        *   Cette fonction envoi la requête à la CA 
                        *   pour générer un certificat.
                        */
                        async function handleGenerateCertificat() {
                            try {
                                const dataToSend = {
                                    common_name: common_name.value,
                                    organization_name: organization_name.value,
                                    locality_name: locality_name.value,
                                    state_or_province_name: state_or_province_name.value,
                                    country_name: country_name.value,
                                };

                                const result = await a_handleGenerateCertificat(dataToSend);
                                printVendeur.value = result;
                            } catch (error) {
                                console.log("VENDEUR Erreur (handleGenerateCertificat) : ", error)
                                printVendeur.value = error;
                            } finally {
                                common_name.value = '';
                                organization_name.value = '';
                                locality_name.value = '';
                                state_or_province_name.value = '';
                                country_name.value = '';
                            }
                        }
        
                    /*== END/CREATE ==*/

                /*==== END/FONCTIONS ====*/

                /*==== ************** ====*/
                /*==== REQUETES AXIOS ====*/
                /*==== ************** ====*/
                    /*== VERIFY ==*/
                        /*
                        *   Vérifie que le serveur du vendeur est allumé.
                        */
                        async function a_checkVendeur() {
                            try {
                                const response = await axios.get('http://127.0.0.1:5002/seller/api/hello');
                                const statusCode = response.status;

                                if(statusCode == 200) {
                                    vendeurAvailable.value = true;
                                } else {
                                    vendeurAvailable.value = false;
                                }
                            } catch (err) {
                                console.log('VENDEUR : Erreur lors de la requête API :', err.message);
                            }
                        }

                        /*
                        *   Vérifie la présence d'une paire de clé RSA sur le vendeur.
                        */
                        async function a_checkRsaKey() {
                            try {
                                const response = await axios.get('http://127.0.0.1:5002/seller/api/check-rsa-key');
                                const statusCode = response.status;

                                if(statusCode == 200) {
                                    return response.data.message;
                                } else {
                                    return response.data.error;
                                }
                            } catch (err) {
                                console.log('VENDEUR : Erreur lors de la requête API :', err.message);
                            }
                        }

                        /*
                        *   Vérifie la présence d'une clé AES à utiliser pour les communications avec 
                        *   la Ca ou le Client.
                        */
                        async function a_checkAesKey(name) {
                            try {
                                const response = await axios.get('http://127.0.0.1:5002/seller/api/check-aes-key',
                                {
                                    params: {
                                        name: name
                                    }
                                });
                                const statusCode = response.status;

                                if(statusCode == 200) {
                                    return response.data.message;
                                } else {
                                    return response.data.error;
                                }
                            } catch (err) {
                                console.log('VENDEUR : Erreur lors de la requête API (a_checkAesKey) :', err.message);
                            } finally { }
                        }
                    /*== END/VERIFY ==*/

                    /*== GET ==*/

                        /*
                        *   Récupère la clé publique de la CA sur le client.
                        *   Et l'affiche sur la vue avec une deuxième requête.
                        */
                        async function a_getPubKeyCA() {
                            try {
                                // J'effectue d'abord la requête qui utilise la file mqtt.
                                const response = await axios.get('http://127.0.0.1:5002/seller/api/get-pub-key-ca');
                                const statusCode = response.status;
                                
                                // Si aucune erreur j'effectue une deuxième requête pour afficher la clé.
                                // Car je ne peux pas attendre la file coté serveur.
                                if (statusCode === 200) {
                                    const responsePrintKey = await axios.get('http://127.0.0.1:5002/seller/api/print-pub-key-ca');
                                    const statusCodePrintKey = responsePrintKey.status;
                        
                                    if (statusCodePrintKey === 200) {
                                        return responsePrintKey.data.message;
                                    } else {
                                        return responsePrintKey.data.message;
                                    }
                                } else {
                                    return responsePrintKey.data.error;
                                }
                            } catch (err) {
                                console.log('VENDEUR : Erreur lors de la requête API :', err.message);
                                return -1; // ou une autre valeur pour indiquer une erreur
                            }
                        }

                        /*
                        *   Récupère la clé publique du vendeur sur le client.
                        *   Et l'affiche sur la vue avec une deuxième requête.
                        */
                        async function a_getPubKeyClient() {
                            try {
                                const response = await axios.get('http://127.0.0.1:5002/seller/api/get-pub-key-client');
                                const statusCode = response.status;
                        
                                if (statusCode === 200) {
                                    const responsePrintKey = await axios.get('http://127.0.0.1:5002/seller/api/print-pub-key-client');
                                    const statusCodePrintKey = responsePrintKey.status;
                        
                                    if (statusCodePrintKey === 200) {
                                        return responsePrintKey.data.message.data;
                                    } else {
                                        throw new Error(responsePrintKey.data.error);
                                    }
                                } else {
                                    throw new Error(response.data.error);
                                }
                            } catch (err) {
                                console.log('VENDEUR : Erreur lors de la requête API :', err.message);
                                return -1; // ou une autre valeur pour indiquer une erreur
                            }
                        }
                        
                        /*
                        *   Retourne la liste de toutes les clé aes dont dispose la CA.
                        */
                        async function a_getAllAesKeys() {
                            try {
                                const response = await axios.get('http://127.0.0.1:5002/seller/api/get-all-aes-key');
                                const statusCode = response.status;

                                if(statusCode == 200) {
                                    return response.data.aes_keys_dic;
                                } else {
                                    printVendeur.value = "ERROR: Erreur lors de la requête API (a_getAllAesKeys)";
                                    console.log('VENDEUR : Erreur lors de la requête API (a_getAllAesKeys)');
                                    return -1;
                                }
                            } catch (err) {
                                printVendeur.value = "ERROR: " + err.message;
                                console.log('VENDEUR : Erreur lors de la requête API (a_getAllAesKeys) : ', err.message);
                            }
                        }

                        /*
                        *   Retourne la liste de toutes les clé aes dont dispose la CA.
                        */
                        async function a_getAllCertificates() {
                            try {
                                const response = await axios.get('http://127.0.0.1:5002/seller/api/get-all-certificates');
                                const statusCode = response.status;

                                if(statusCode == 200) {
                                    return response.data.certificates_dic;
                                } else {
                                    printVendeur.value = "ERROR: Erreur lors de la requête API (a_getAllCertificates)";
                                    console.log('VENDEUR : Erreur lors de la requête API (a_getAllCertificates)');
                                    return -1;
                                }
                            } catch (err) {
                                printVendeur.value = "ERROR: " + err.message;
                                console.log('VENDEUR : Erreur lors de la requête API (a_getAllCertificates) : ', err.message);
                            }
                        }

                    /*== END/GET ==*/

                    /*== UPDATE ==*/
                        /*
                        *   Met à jour le certificat par défaut à transmettre au client.
                        */
                        async function a_updateCertificatSender() {
                            console.log("Certificat choisi: "+ selectedCertificatToSend.value);

                            try {
                                let dataToSend = {
                                    'certId': selectedCertificatToSend.value
                                }
                                const response = await axios.put('http://127.0.0.1:5002/seller/api/update-certificat-sender', dataToSend);
                                const statusCode = response.status;

                                if(statusCode == 200) {
                                    default_certif.value = selectedCertificatToSend.value;
                                    return response.data.message;
                                } else {
                                    return response.data.error;
                                }
                            } catch (err) {
                                console.log('VENDEUR : Erreur lors de la requête API (a_updateCertificatSender) :', err.message);
                            } finally { 
                                selectedCertificatToSend.value = '';
                            }
                        }
                    /*== END/UPDATE ==*/

                    /*== CREATE ==*/
                        /*
                        *   Génère une paire de clé RSA.
                        */
                        async function a_generateRsaKey() {
                            try {
                                const response = await axios.get('http://127.0.0.1:5002/seller/api/generate-rsa-key');
                                const statusCode = response.status;

                                if(statusCode == 200) {
                                    return response.data.message;
                                } else {
                                    return response.data.error;
                                }
                            } catch (err) {
                                console.log('CLIENT : Erreur lors de la requête API (a_generateRsaKey) :', err.message);
                            } finally { }
                        }

                        /*
                        *   Génère une clé AES.
                        */
                        async function a_generateAesKey(name) {
                            try {
                                const response = await axios.get('http://127.0.0.1:5002/seller/api/generate-aes-key',
                                {
                                    params: {
                                        name: name
                                    }
                                });
                                const statusCode = response.status;

                                if(statusCode == 200) {
                                    return response.data.message;
                                } else {
                                    return response.data.error;
                                }
                            } catch (err) {
                                return err;
                                console.log('VENDEUR : Erreur lors de la requête API (a_generateAesKey) :', err.message);
                            }
                        }
                    
                        /*
                        *   Echange un secret entre le vendeur et la CA.
                        */
                        async function a_secretExchangeCa() {
                            try {
                                const response = await axios.get('http://127.0.0.1:5002/seller/api/secret-exchange-ca');
                                const statusCode = response.status;
                        
                                if (statusCode == 200) {
                                    return response.data.message;
                                } else {
                                    return response.data.error;
                                }
                            } catch (err) {
                                console.log('VENDEUR : Erreur lors de la requête API :', err.message);
                            } finally {
                                getAllAesKeys();
                            }
                        }                        
                    
                        async function a_handleGenerateCertificat(dataToSend) {
                            try {
                                const response = await axios.post('http://127.0.0.1:5002/seller/api/request-certificat', dataToSend);
                                const statusCode = response.status;
                        
                                if (statusCode == 200) {
                                    return response.data.message;
                                } else {
                                    return response.data.message;
                                }
                            } catch (err) {
                                console.log('VENDEUR : Erreur lors de la requête API (a_handleGenerateCertificat) : ', err.message);
                            } finally {
                                getAllCertificates();
                            }
                        }
                    /*== END/CREATE ==*/

                /*==== END/REQUETES AXIOS ====*/

                onMounted(async () => {
                    a_checkVendeur();
                });

                return {
                    vendeurAvailable,
                    printVendeur,
                    selectedPubKeyReq,
                    aesKeys,

                    // Génération du certificat
                    country_name,
                    state_or_province_name,
                    locality_name,
                    organization_name,
                    common_name,
                    btnHandleGenerateCertificat,
                    certificatesList,
                    selectedCertificatToSend,
                    default_certif,

                    // Fonctions
                    cleanPrintVendeur,

                    // GET
                    getPubKey,
                    checkRsaKey,
                    checkAesKey,
                    getAllAesKeys,
                    getAllCertificates,

                    // CREATE
                    generateRsaKey,
                    generateAesKey,
                    secretExchangeCa,
                    handleGenerateCertificat,

                    // UPDATE
                    updateCertificatSender,
                }
            }
        }).mount('#vendeur');

        // Client
        createApp({
            setup() {
                // Variables
                let error = ref('');

                let clientAvailable = ref(false);
                let selectedPubKeyReq = ref(null);
                let clearPrintTimer;

                // Résultat d'une requête
                let printClient = ref('');

                // Liste des clé AES à disposition
                let aesKeys = ref([]);

                /*==== FONCTIONS ====*/
                    /*== TOOLS ==*/
                        function cleanPrintClient() {
                            printClient.value = '';
                        }
                        
                        function autoClearPrintClient() {
                            clearTimeout(clearPrintTimer); // Réinitialise le timer à chaque fois que la fonction est appelée
                            clearPrintTimer = setTimeout(cleanPrintClient, 10000);
                        }
                        
                        watch(printClient, () => {
                            autoClearPrintClient();
                        });
                    /*== TOOLS ==*/

                    /*== VERIFY ==*/
                        /**
                        *   Vérifie que le client dispose de 
                        *   clé RSA.
                        */
                        async function checkRsaKey() {
                            try {
                                const result = await a_checkRsaKey();
                                printClient.value = result;
                            } catch (error) {
                                console.error('Erreur :', error);
                            }
                        }

                        /**
                        *   Vérifie que le client dispose d'une clé AES.
                        */
                        async function checkAesKey(name) {
                            try {
                                const result = await a_checkAesKey(name);
                                printClient.value = result;
                            } catch (error) {
                                console.error('Client : Erreur :', error);
                            }
                        }
                    /*== END/VERIFY ==*/

                    /*== GET ==*/
                        /*
                        *   Récupère la clé publique de la CA ou du Vendeur.
                        */
                        async function getPubKey() {
                            if (selectedPubKeyReq.value === "ca") {
                                try {
                                    const result = await a_getPubKeyCA();
                                    if(result != -1){
                                        printClient.value = result;
                                    } else {
                                        printClient.value = "ERREUR SERVEUR.";
                                    }
                                } catch (error) {
                                    printClient.value = "ERREUR SERVEUR.";
                                }
                            } 
                            else if (selectedPubKeyReq.value === "vendeur") {
                                try {
                                    const result = await a_getPubKeyVendeur();
                                    if(result != -1){
                                        printClient.value = result;
                                    } else {
                                        printClient.value = "ERREUR SERVEUR.";
                                    }
                                } catch (error) {
                                    printClient.value = "ERREUR SERVEUR.";
                                }
                            }

                            selectedPubKeyReq.value = null;
                        }

                        /*
                        *   Retourne au format base64 toutes les clés AES
                        *   dont le vendeur dispose.
                        */
                        async function getAllAesKeys() {
                            try {
                                aesKeys.value = [];
                                const result = await a_getAllAesKeys();
                                if (result !== -1) {
                                    aesKeys.value = Object.entries(result).map(([identifiant, key]) => ({ identifiant, key }));
                                }
                            } catch (error) {
                                console.error('Erreur :', error);
                            }
                        }

                        async function getSellerCertificate() {
                            try {
                                const result = await a_getSellerCertificate();
                                printClient.value = result;
                            } catch (error) {
                                console.error('Erreur :', error);
                            }
                        }
                    /*== END/GET ==*/

                    /*== CREATE ==*/
                        /*
                        *   Génère les clés RSA.
                        */
                        async function generateRsaKey() {
                            try {
                                const result = await a_generateRsaKey();
                                printClient.value = result;
                            } catch (error) {
                                console.error('Erreur :', error);
                            }
                        }

                        /*
                        *   Génère la clé AES.
                        */
                        async function generateAesKey(name) {
                            try {
                                const result = await a_generateAesKey(name);
                                printClient.value = result;
                            } catch (error) {
                                printClient.value = error;
                                console.error('Erreur :', error);
                            }
                        }

                        /**
                        *   Permet de faire l'échange du secret
                        *   entre le client et la CA.
                        */
                        async function secretExchangeCa() {
                            try {
                                const result = await a_secretExchangeCa();
                                printClient.value = result;
                            } catch (error) {
                                printClient.value = error;
                            }
                        }

                        /**
                        *   Permet de faire l'échange du secret
                        *   entre le client et le vendeur.
                        */
                        async function secretExchangeSeller() {
                            try {
                                const result = await a_secretExchangeSeller();
                                printClient.value = result;
                            } catch (error) {
                                printClient.value = error;
                            }
                        }
                    /*== END/CREATE ==*/

                /*==== END/FONCTIONS ====*/

                /*==== ************** ====*/
                /*==== REQUETES AXIOS ====*/
                /*==== ************** ====*/
                    /*== VERIFY ==*/
                        /*
                        *   Vérifie que le serveur du client est allumé.
                        */
                        async function checkClient() {
                            try {
                                const response = await axios.get('http://127.0.0.1:5001/client/api/hello');
                                const statusCode = response.status;

                                if(statusCode == 200) {
                                    clientAvailable.value = true;
                                } else {
                                    vendeurAvailable.value = false;
                                }
                            } catch (err) {
                                console.log('CLIENT : Erreur lors de la requête API (checkClient) :', err.message);
                            }
                        }

                        /*
                        *   Vérifie la présence d'une paire de clé RSA sur le client.
                        */
                        async function a_checkRsaKey() {
                            try {
                                const response = await axios.get('http://127.0.0.1:5001/client/api/check-rsa-key');
                                const statusCode = response.status;

                                if(statusCode == 200) {
                                    return response.data.message;
                                } else {
                                    return response.data.error;
                                }
                            } catch (err) {
                                console.log('CLIENT : Erreur lors de la requête API (a_checkRsaKey) :', err.message);
                            }
                        }

                        /*
                        *   Vérifie la présence de clés AES
                        *   soit celle à utiliser avec la CA soit pour Vendeur.
                        */
                        async function a_checkAesKey(name) {
                            try {
                                const response = await axios.get('http://127.0.0.1:5001/client/api/check-aes-key',
                                {
                                    params: {
                                        name: name
                                    }
                                });
                                const statusCode = response.status;

                                if(statusCode == 200) {
                                    return response.data.message;
                                } else {
                                    return response.data.error;
                                }
                            } catch (err) {
                                console.log('CLIENT : Erreur lors de la requête API (a_checkAesKey) :', err.message);
                            } finally { }
                        }
                    /*== END/VERIFY ==*/

                    /*== GET ==*/
                    
                        /*
                        *   Retourne la liste de toutes les clé aes dont dispose la CA.
                        */
                        async function a_getSellerCertificate() {
                            try {
                                const response = await axios.get('http://127.0.0.1:5001/client/api/get-seller-certificate');
                                const statusCode = response.status;

                                if(statusCode == 200) {
                                    const response2 = await axios.get('http://127.0.0.1:5001/client/api/verify-seller-certificate');
                                    const statusCode2 = response.status;

                                    return response2.data.message;
                                } else {
                                    printClient.value = "ERROR: Erreur lors de la requête API (a_getSellerCertificate)";
                                    console.log('CLIENT : Erreur lors de la requête API (a_getSellerCertificate)');
                                    return -1;
                                }
                            } catch (err) {
                                printClient.value = "ERROR: " + err.message;
                                console.log('CLIENT : Erreur lors de la requête API (a_getSellerCertificate) : ', err.message);
                            }
                        }
                    
                        /*
                        *   Récupère la clé publique de la CA sur le client.
                        *   Et l'affiche sur la vue avec une deuxième requête.
                        */
                        async function a_getPubKeyCA() {
                            try {
                                // J'effectue d'abord la requête qui utilise la file mqtt.
                                const response = await axios.get('http://127.0.0.1:5001/client/api/get-pub-key-ca');
                                const statusCode = response.status;
                                
                                // Si aucune erreur j'effectue une deuxième requête pour afficher la clé.
                                // Car je ne peux pas attendre la file coté serveur.
                                if (statusCode === 200) {
                                    const responsePrintKey = await axios.get('http://127.0.0.1:5001/client/api/print-pub-key-ca');
                                    const statusCodePrintKey = responsePrintKey.status;
                        
                                    if (statusCodePrintKey === 200) {
                                        return responsePrintKey.data.message.data;
                                    } else {
                                        return responsePrintKey.data.data;
                                    }
                                } else {
                                    return responsePrintKey.data.data;
                                }
                            } catch (err) {
                                console.log('CLIENT : Erreur lors de la requête API (a_getPubKeyCA) :', err.message);
                                return -1; // ou une autre valeur pour indiquer une erreur
                            }
                        }

                        /*
                        *   Récupère la clé publique du vendeur sur le client.
                        *   Et l'affiche sur la vue avec une deuxième requête.
                        */
                        async function a_getPubKeyVendeur() {
                            try {
                                const response = await axios.get('http://127.0.0.1:5001/client/api/get-pub-key-seller');
                                const statusCode = response.status;
                        
                                if (statusCode === 200) {
                                    const responsePrintKey = await axios.get('http://127.0.0.1:5001/client/api/print-pub-key-seller');
                                    const statusCodePrintKey = responsePrintKey.status;
                        
                                    if (statusCodePrintKey === 200) {
                                        return responsePrintKey.data.message.data;
                                    } else {
                                        throw new Error(responsePrintKey.data.error);
                                    }
                                } else {
                                    throw new Error(response.data.error);
                                }
                            } catch (err) {
                                console.log('CLIENT : Erreur lors de la requête API(a_getPubKeyVendeur) :', err.message);
                                return -1; // ou une autre valeur pour indiquer une erreur
                            }
                        }
                        
                        /*
                        *   Retourne la liste de toutes les clé aes dont dispose la CA.
                        */
                        async function a_getAllAesKeys() {
                            try {
                                const response = await axios.get('http://127.0.0.1:5001/client/api/get-all-aes-key');
                                const statusCode = response.status;

                                if(statusCode == 200) {
                                    return response.data.aes_keys_dic;
                                } else {
                                    printClient.value = "ERROR: Erreur lors de la requête API (a_getAllAesKeys)";
                                    console.log('CLIENT : Erreur lors de la requête API (a_getAllAesKeys)');
                                    return -1;
                                }
                            } catch (err) {
                                printClient.value = "ERROR: " + err.message;
                                console.log('CLIENT : Erreur lors de la requête API (a_getAllAesKeys) : ', err.message);
                            }
                        }
                    
                    /*== END/GET ==*/


                    /*== CREATE ==*/
                        /*
                        *   Génère une paire de clé RSA.
                        */
                        async function a_generateRsaKey() {
                            try {
                                const response = await axios.get('http://127.0.0.1:5001/client/api/generate-rsa-key');
                                const statusCode = response.status;

                                if(statusCode == 200) {
                                    return response.data.message;
                                } else {
                                    return response.data.error;
                                }
                            } catch (err) {
                                console.log('CLIENT : Erreur lors de la requête API (a_generateRsaKey) :', err.message);
                            }
                        }

                        /*
                        *   Génère une clé AES.
                        */
                        async function a_generateAesKey(name) {
                            try {
                                const response = await axios.get('http://127.0.0.1:5001/client/api/generate-aes-key',
                                {
                                    params: {
                                        name: name
                                    }
                                });
                                const statusCode = response.status;

                                if(statusCode == 200) {
                                    return response.data.message;
                                } else {
                                    return response.data.error;
                                }
                            } catch (err) {
                                return err;
                                console.log('CLIENT : Erreur lors de la requête API (a_generateAesKey) :', err.message);
                            }
                        }

                        /*
                        *   Echange un secret entre le client et la CA.
                        */
                        async function a_secretExchangeCa() {
                            try {
                                const response = await axios.get('http://127.0.0.1:5001/client/api/secret-exchange-ca');
                                const statusCode = response.status;
                        
                                if (statusCode == 200) {
                                    return response.data.message;
                                } else {
                                    return response.data.error;
                                }
                            } catch (err) {
                                console.log('CLIENT : Erreur lors de la requête API (a_secretExchangeCa) :', err.message);
                            }
                        }    
                        
                        /*
                        *   Echange un secret entre le client et le vendeur.
                        */
                        async function a_secretExchangeSeller() {
                            try {
                                const response = await axios.get('http://127.0.0.1:5001/client/api/secret-exchange-seller');
                                const statusCode = response.status;
                        
                                if (statusCode == 200) {
                                    return response.data.message;
                                } else {
                                    return response.data.error;
                                }
                            } catch (err) {
                                console.log('CLIENT : Erreur lors de la requête API (a_secretExchangeCa) :', err.message);
                            }
                        }    

                    /*== END/CREATE ==*/

                /*==== END/REQUETES AXIOS ====*/

                onMounted(async () => {
                    checkClient();
                });

                return {
                    clientAvailable,

                    selectedPubKeyReq,
                    printClient,
                    aesKeys,

                    // Outils
                    cleanPrintClient,

                    // Fonctions Créations
                    generateRsaKey,
                    generateAesKey,
                    getPubKey,
                    secretExchangeCa,
                    secretExchangeSeller,

                    // Fonctions Vérifs
                    checkRsaKey,
                    checkAesKey,

                    // GET
                    getAllAesKeys,
                    getSellerCertificate,
                }
            }
        }).mount('#client');

        // CA
        createApp({
            setup() {
                // Variables
                let error = ref('');

                let caAvailable = ref(false);
                let printCa = ref('');
                let clearPrintTimer;

                // Liste des clés AES
                let aesKeys = ref([]);

                /*==== FONCTIONS ====*/
                    /*== TOOLS ==*/
                        function cleanPrintCa() {
                            printCa.value = '';
                        }
                        
                        function autoClearPrintCa() {
                            clearTimeout(clearPrintTimer); // Réinitialise le timer à chaque fois que la fonction est appelée
                            clearPrintTimer = setTimeout(cleanPrintCa, 10000);
                        }
                        
                        watch(printCa, () => {
                            autoClearPrintCa();
                        });
                    /*== TOOLS ==*/

                    /*
                    *   Génère le certificat autosigné de la CA.
                    */
                    async function generateSelfSignedCertificate() {
                        try {
                            const result = await a_generateSelfSignedCertificate();
                            printCa.value = result;
                        } catch (error) {
                            console.error('Erreur :', error);
                        }
                    }

                    /*
                    *   Affiche le certificat autosigné de la CA.
                    */
                    async function checkSelfSignedCertificate() {
                        try {
                            const result = await a_checkSelfSignedCertificate();
                            printCa.value = result;
                        } catch (error) {
                            console.error('Erreur :', error);
                        }
                    }

                    /*
                    *   Retourne au format base64 toutes les clés AES
                    *   dont la CA dispose.
                    */
                    async function getAllAesKeys() {
                        try {
                            aesKeys.value = [];
                            const result = await a_getAllAesKeys();
                            if (result !== -1) {
                                aesKeys.value = Object.entries(result).map(([identifiant, key]) => ({ identifiant, key }));
                            }
                        } catch (error) {
                            console.error('Erreur :', error);
                        }
                    }
                /*==== END/FONCTIONS ====*/

                /*==== ************** ====*/
                /*==== REQUETES AXIOS ====*/
                /*==== ************** ====*/
                    /*
                    *   Vérifie que le serveur de la CA est allumé.
                    */
                    async function checkCa() {
                        try {
                            const response = await axios.get('http://127.0.0.1:5000/ca/api/hello');
                            const statusCode = response.status;

                            if(statusCode == 200) {
                                caAvailable.value = true;
                            } else {
                                caAvailable.value = false;
                            }
                        } catch (err) {
                            console.log('CA : Erreur lors de la requête API (checkCa) :', err.message);
                        }
                    }

                    /*
                    *   Génère un certificat autosigné pour la CA.
                    */
                    async function a_generateSelfSignedCertificate() {
                        try {
                            const response = await axios.get('http://127.0.0.1:5000/ca/create-self-certificat');
                            const statusCode = response.status;

                            if(statusCode == 200) {
                                return response.data.data;
                            } else {
                                console.log('CA : Erreur lors de la requête API (a_generateSelfSignedCertificate) : ', err.message);
                                return -1;
                            }
                        } catch (err) {
                            console.log('CA : Erreur lors de la requête API (a_generateSelfSignedCertificate) : ', err.message);
                        }
                    }

                    /*
                    *   Vérifie que la CA possède son certificat autosigné.
                    */
                    async function a_checkSelfSignedCertificate() {
                        try {
                            const response = await axios.get('http://127.0.0.1:5000/ca/check-ca-certificat');
                            const statusCode = response.status;

                            if(statusCode == 200) {
                                return response.data.data;
                            } else {
                                console.log('CA : Erreur lors de la requête API (a_checkSelfSignedCertificate) :', err.message);
                                return -1;
                            }
                        } catch (err) {
                            console.log('CA : Erreur lors de la requête API (a_checkSelfSignedCertificate) :', err.message);
                        }
                    }
                    
                    /*
                    *   Retourne la liste de toutes les clé aes dont dispose la CA.
                    */
                    async function a_getAllAesKeys() {
                        try {
                            const response = await axios.get('http://127.0.0.1:5000/ca/api/get-all-aes-key');
                            const statusCode = response.status;

                            if(statusCode == 200) {
                                return response.data.aes_keys_dic;
                            } else {
                                printCa.value = "ERROR: Erreur lors de la requête API (a_getAllAesKeys)";
                                console.log('CA : Erreur lors de la requête API (a_getAllAesKeys)');
                                return -1;
                            }
                        } catch (err) {
                            printCa.value = "ERROR: " + err.message;
                            console.log('CA : Erreur lors de la requête API (a_getAllAesKeys) : ', err.message);
                        }
                    }

                /*==== END/REQUETES AXIOS ====*/

                onMounted(async () => {
                    checkCa();
                    if (caAvailable.value == true) {
                        getAllAesKeys();
                    }
                });

                return {
                    caAvailable,
                    printCa,
                    aesKeys,

                    // Fonctions
                    cleanPrintCa,
                    getAllAesKeys,

                    generateSelfSignedCertificate,
                    checkSelfSignedCertificate,
                }
            }
        }).mount('#ca');
    </script>
</body>
</html>