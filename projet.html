<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    
    <!-- CSS -->
    <link rel="stylesheet" href="style.css">

    <title>PROJET PKI</title>

    <!-- CDN Google -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">

    <!-- CDN Bootsrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    
    <!-- CDN Axios -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>

<!-- For prod : vue.esm-browser.prod.js -->
<script type="importmap">
    {
        "imports": {
            "vue": "https://unpkg.com/vue@3/dist/vue.esm-browser.js"
        }
    }
</script>

<body class="container-fluid" v-show="!loading">
    <div id="app">
        <!-- Loading animation -->
        <div v-if="loading" id="loading-animation">
            <div class="spinner"></div>
        </div> <!-- Loading animation -->

        <h1>PROJET PKI</h1>
    </div>

    <div class="projet">
        <div class="client-vendeur">
            <div class="client" id="client">

                <!-- CLIENT -->
                <div v-if="clientAvailable" class="client-content">
                    <div class="client-header">
                        <span class="material-icons s_XL">person</span>
                        <h5>Client actif</h5>
                    </div>

                    <div class="client-operations operations">
                        <h6 class="c_1">Opérations disponibles</h6>

                        <div class="operations-btns">
                            <div class="operation-btn mb-2 bg_1">
                                <label for="operation" class="form-label">Générer une paire de clés RSA 2048</label>
                                <button @click="generateRsaKey" class="btn btn-sm btn-primary">Générer</button>
                            </div>

                            <div class="operation-btn mb-2 bg_1">
                                <label for="operation" class="form-label">Générer une clé AES</label>
                                <button @click="generateAesKey" class="btn btn-sm btn-primary">Générer</button>
                            </div>

                            <div class="operation-btn mb-2 bg_2">
                                <label for="operation" class="form-label">Vérifier la disponibilité des clés</label>
                                <div class="btns-flex">
                                    <button @click="checkRsaKey" class="btn btn-sm btn-primary" type="button">RSA</button>
                                    <button @click="checkAesKey" class="btn btn-sm btn-success" type="button">AES</button>
                                </div>
                            </div>

                            <div class="operation-btn mb-2 bg_2">
                                <label for="operation" class="form-label">Obtenir la clé publique</label>
                                <select class="form-select" aria-label="Default select example" v-model="selectedPubKeyReq">
                                    <option selected disabled>Choisir</option>
                                    <option value="vendeur">Vendeur</option>
                                    <option value="ca">Ca</option>
                                </select>
                                <button class="btn btn-sm btn-success mt-2" type="button" :disabled="selectedPubKeyReq === null" @click="getPubKey">Obtenir</button>
                            </div>
                        </div>
                    </div>

                    <div class="client-print print">
                        <h6 class="c_1">Sortie</h6>
                        <div class="print-final">
                            {{ printClient }}
                        </div>
                    </div>
                </div>
                <div v-else class="client-off">
                    <span class="material-icons s_XL">error</span>
                    <h6>Veuillez allumer le serveur du client.</h2>
                </div>
            </div> <!-- CLIENT -->
            
            <!-- VENDEUR -->
            <div class="vendeur" id="vendeur">
                <div v-if="vendeurAvailable" class="vendeur-content">
                    <div class="vendeur-header">
                        <span class="material-icons s_XL">storefront</span>
                        <h5>Vendeur actif</h5>
                    </div>

                    <div class="vendeur-operations operations">
                        <h6 class="c_1">Opérations disponibles</h6>
                    </div>

                    <div class="vendeur-print print">
                        <h6 class="c_1">Sortie</h6>
                    </div>

                </div>
                <div v-else class="vendeur-off">
                    <span class="material-icons s_XL">error</span>
                    <h6>Veuillez allumer le serveur du vendeur.</h6>
                </div>
            </div> <!-- VENDEUR -->
        </div> 
        
        <!-- CA -->
        <div class="ca" id="ca">
            <div v-if="caAvailable" class="ca-content">
                <div class="ca-header">
                    <span class="material-icons s_XL">admin_panel_settings</span>
                    <h5>Ca actif</h5>
                </div>

                <div class="ca-operations operations">
                    <h6 class="c_1">Opérations disponibles</h6>
                </div>

                <div class="ca-print print">
                    <h6 class="c_1">Sortie</h6>
                </div>
            </div>
            <div v-else class="ca-off">
                <span class="material-icons s_XL">error</span>
                <h6>Veuillez allumer le serveur de la CA.</h6>
            </div>
        </div> <!-- CA -->
    </div>
    

    <!-- Bootsrap CDN -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

    <!-- VueJS3 -->
    <script type="module">
        import { createApp, onMounted, ref } from 'vue'
        
        // Main app
        createApp({
            setup() {
                // Variables
                let loading = ref(true);

                // Utilisation de l'hook onMounted pour exécuter du code lors du montage de l'application
                onMounted(async () => {
                    // Loading animation
                    window.addEventListener('load', () => {
                        loading.value = false;
                    });
                });

                return {
                    loading,
                }
            }
        }).mount('#app');

        // Vendeur
        createApp({
            setup() {
                // Variables
                let error = ref('');

                let vendeurAvailable = ref(false);

                /*==== FONCTIONS ====*/
                
                /*==== END/FONCTIONS ====*/

                /*==== REQUETES AXIOS ====*/
                
                    /*
                    *   Vérifie que le serveur du vendeur est allumé.
                    */
                    async function checkVendeur() {
                        try {
                            const response = await axios.get('http://127.0.0.1:5002/vendeur/api/hello');
                            const statusCode = response.status;

                            if(statusCode == 200) {
                                vendeurAvailable.value = true;
                            } else {
                                vendeurAvailable.value = false;
                            }
                        } catch (err) {
                            console.log('VENDEUR : Erreur lors de la requête API :', err.message);
                        } finally {
                            
                        }
                    }
                /*==== END/REQUETES AXIOS ====*/

                onMounted(async () => {
                    checkVendeur();
                });

                return {
                    vendeurAvailable,
                }
            }
        }).mount('#vendeur');

        // Client
        createApp({
            setup() {
                // Variables
                let error = ref('');

                let clientAvailable = ref(false);
                let selectedPubKeyReq = ref(null);
                // Résultat d'une requête
                let printClient = ref('');


                /*==== FONCTIONS ====*/
                    /*== Vérifs ==*/
                        async function checkRsaKey() {
                            try {
                                const result = await a_checkRsaKey();
                                printClient.value = result;
                            } catch (error) {
                                console.error('Erreur :', error);
                            }
                        }

                        async function checkAesKey() {
                            try {
                                const result = await a_checkAesKey();
                                printClient.value = result;
                            } catch (error) {
                                console.error('Client : Erreur :', error);
                            }
                        }
                    /*== END/Vérifs ==*/

                    /*== Creations ==*/
                        /*
                        *   Génère les clés RSA.
                        */
                        async function generateRsaKey() {
                            try {
                                const result = await a_generateRsaKey();
                                printClient.value = result;
                            } catch (error) {
                                console.error('Erreur :', error);
                            }
                        }

                        /*
                        *   Génère la clé AES.
                        */
                        async function generateAesKey() {
                            try {
                                const result = await a_generateAesKey();
                                printClient.value = result;
                            } catch (error) {
                                console.error('Erreur :', error);
                            }
                        }

                        function getPubKey() {
                            
                            console.log('Option sélectionnée :', selectedPubKeyReq.value);
   
                        }

                    /*== END/Creations ==*/

                /*==== END/FONCTIONS ====*/

                /*==== REQUETES AXIOS ====*/
                    
                    /*== Vérifs ==*/

                        /*
                        *   Vérifie que le serveur du client est allumé.
                        */
                        async function checkClient() {
                            try {
                                const response = await axios.get('http://127.0.0.1:5001/client/api/hello');
                                const statusCode = response.status;

                                if(statusCode == 200) {
                                    clientAvailable.value = true;
                                } else {
                                    vendeurAvailable.value = false;
                                }
                            } catch (err) {
                                console.log('CLIENT : Erreur lors de la requête API :', err.message);
                            }
                        }


                        /*
                        *   Vérifie la présence d'une paire de clé RSA sur le client.
                        */
                        async function a_checkRsaKey() {
                            try {
                                const response = await axios.get('http://127.0.0.1:5001/client/api/check-rsa-key');
                                const statusCode = response.status;

                                if(statusCode == 200) {
                                    return response.data.message;
                                } else {
                                    return response.data.error;
                                }
                            } catch (err) {
                                console.log('CLIENT : Erreur lors de la requête API :', err.message);
                            }
                        }

                        /*
                        *   Vérifie la présence d'une paire de clé RSA sur le client.
                        */
                        async function a_checkAesKey() {
                            try {
                                const response = await axios.get('http://127.0.0.1:5001/client/api/check-aes-key');
                                const statusCode = response.status;

                                if(statusCode == 200) {
                                    return response.data.message;
                                } else {
                                    return response.data.error;
                                }
                            } catch (err) {
                                console.log('CLIENT : Erreur lors de la requête API :', err.message);
                            } finally { }
                        }

                    /*== END/Vérifs ==*/

                    /*== Creations ==*/
                    
                        /*
                        *   Génère une paire de clé RSA.
                        */
                        async function a_generateRsaKey() {
                            try {
                                const response = await axios.get('http://127.0.0.1:5001/client/api/generate-rsa-key');
                                const statusCode = response.status;

                                if(statusCode == 200) {
                                    return response.data.message;
                                } else {
                                    return response.data.error;
                                }
                            } catch (err) {
                                console.log('CLIENT : Erreur lors de la requête API :', err.message);
                            } finally { }
                        }

                        /*
                        *   Génère une clé AES.
                        */
                        async function a_generateAesKey() {
                            try {
                                const response = await axios.get('http://127.0.0.1:5001/client/api/generate-aes-key');
                                const statusCode = response.status;

                                if(statusCode == 200) {
                                    return response.data.message;
                                } else {
                                    return response.data.error;
                                }
                            } catch (err) {
                                console.log('CLIENT : Erreur lors de la requête API :', err.message);
                            } finally { }
                        }

                    /*== END/Creations ==*/

                    

                    
                /*==== END/REQUETES AXIOS ====*/

                onMounted(async () => {
                    checkClient();
                });

                return {
                    clientAvailable,

                    selectedPubKeyReq,
                    printClient,

                    // Fonctions Créations
                    generateRsaKey,
                    generateAesKey,
                    getPubKey,

                    // Fonctions Vérifs
                    checkRsaKey,
                    checkAesKey,
                }
            }
        }).mount('#client');

        // CA
        createApp({
            setup() {
                // Variables
                let error = ref('');

                let caAvailable = ref(false);

                /*==== FONCTIONS ====*/
                
                /*==== END/FONCTIONS ====*/

                /*==== REQUETES AXIOS ====*/
                
                    /*
                    *   Vérifie que le serveur de la CA est allumé.
                    */
                    async function checkCa() {
                        try {
                            const response = await axios.get('http://127.0.0.1:5000/ca/api/hello');
                            const statusCode = response.status;

                            if(statusCode == 200) {
                                caAvailable.value = true;
                            } else {
                                vendeurAvailable.value = false;
                            }
                        } catch (err) {
                            console.log('CA : Erreur lors de la requête API :', err.message);
                        } finally {}
                    }
                /*==== END/REQUETES AXIOS ====*/

                onMounted(async () => {
                    checkCa();
                });

                return {
                    caAvailable,
                }
            }
        }).mount('#ca');
    </script>
</body>
</html>